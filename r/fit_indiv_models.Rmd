
Setup - install packages and source functions. 
```{r}
# clean slate to be sure
rm(list = ls())

# check for pacman package and install if not found
if (!require("pacman")) install.packages("pacman")
pacman::p_load(afex, readr, dplyr, tidyr, ggplot2, cowplot, devtools, here, tidyverse, magrittr, reshape2, rjags, coda, lattice, broom, ggmcmc, foreach, doParallel, ggpubr, ggpol, patchwork, ggcorrplot, ggstatsplot, GGally, BayesFactor, gridExtra)

# load the metaSDT package from github
if (!require("metaSDT")) devtools::install_github("craddm/metaSDT")
# load Rousselet correlation package 
if (!require("bootcorci")) devtools::install_github("GRousselet/bootcorci")

source(here("r", "remove_outliers_robust.R"))
source(here("r", "outliers.R"))
source(here("r", "trials2counts.R"))
source(here("r", "metad_indiv.R"))
source(here("r", "fit_mle.R"))
source(here("r", "sdt_functions.R"))
source(here("r", "Function_metad_groupcorr.R"))
source(here("r", "BootCorci.R"))
source(here("r", "scatterplot.R"))

```


Load the data. 
```{r}
# read in the data

metacognition_trial_data <- read_csv(here("data_summary", "metacognition_TrialData_master.csv"), 
    col_types = cols(confidence = col_double(), 
        rt_conf = col_double()))

# set modality as factor
metacognition_trial_data$modality <- as.factor(metacognition_trial_data$modality )

# remove any rows containing NaNs (i.e., missing data)

metacognition_trial_data <- na.omit(metacognition_trial_data)

head(metacognition_trial_data)

```

Trial-level exclusion (following prereg)
```{r}

metadata <- metacognition_trial_data %>%
  group_by(subject, modality) %>%
  mutate(rt = remove_outliers_robust(rt)) # remove RT outliers using MAD Rule - SEE PRE REG

metadata <- na.omit(metadata)

#Exclude those with rt <50ms 
metadata <- metadata%>%filter(rt>=0.05) 


#Exclude those with less than 50% trials (i.e. less than 100 or 50) within condition
metadata<-metadata%>%mutate(modality=as.factor(modality))
metadatac<-metadata #create new dataframe
metadatac$modality <-fct_collapse (metadatac$modality, trivia = c("Calories", "GDP"))#combine the two trivia tasks in new dataframe
metadatac <- metadatac %>%
  group_by(subject, modality)%>% count(subject) #count number of trials
excD <- subset(metadatac, metadatac$n<100) 
excID <-unique(excD$subject) #Identify participants for exclusion
metadata <- subset(metadata, !is.element(metadata$subject, excID)) ##Exclude IDs from that vector in original dataframe

```

Create individual level staircase plots 
```{r}
# note that this procedure can take a long time - uncomment to make individual plots for QC procedure
#source(here("r", "make_indivi_plots.R"))

```

Group level staircase plots
```{r}

#Memory:
memory <- metadata %>%group_by(subject) %>% 
  filter(modality == c('memory'))  %>%  mutate(trial_number = row_number()) %>%
  group_by(subject) 
  
memory$trial_bin <- cut(memory$trial_number, breaks = 4, labels = c("1st", "2nd", "3rd","4th"))

plot_dataM <- memory %>%
  group_by(trial_bin) %>%
  summarise(mean = mean(accuracy), se = sd(accuracy)/sqrt(length(accuracy))) %>%
  ungroup()
  
SM<-ggplot(data = plot_dataM, aes(x = trial_bin, y = mean, group = 1)) +
    geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.05) +
    geom_line() +
    geom_point() +
    theme_bw() +
    ylab("Average Accuracy")+
    xlab("Trial Quarter")+ 
    ylim(.5, 1)

#Calories: 
calories <- metadata %>%group_by(subject) %>% 
  filter(modality == c('Calories'))  %>%  mutate(trial_number = row_number()) %>%
  group_by(subject) 
  
calories$trial_bin <- cut(calories$trial_number, breaks = 4, labels = c("1st", "2nd", "3rd","4th"))

plot_dataC <- calories %>%
  group_by(trial_bin) %>%
  summarise(mean = mean(accuracy), se = sd(accuracy)/sqrt(length(accuracy))) %>%
  ungroup()
  
SC<-ggplot(data = plot_dataC, aes(x = trial_bin, y = mean, group = 1)) +
    geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.05) +
    geom_line() +
    geom_point() +
    theme_bw() +
    ylab("Average Accuracy")+
    xlab("Trial Quarter")+ 
    ylim(.5, 1)

#GDP
GDP <- metadata %>%group_by(subject) %>% 
  filter(modality == c('GDP'))  %>%  mutate(trial_number = row_number()) %>%
  group_by(subject) 
  
GDP$trial_bin <- cut(GDP$trial_number, breaks = 4, labels = c("1st", "2nd", "3rd","4th"))

plot_dataG <- GDP %>%
  group_by(trial_bin) %>%
  summarise(mean = mean(accuracy), se = sd(accuracy)/sqrt(length(accuracy))) %>%
  ungroup()
  
SG<-ggplot(data = plot_dataG, aes(x = trial_bin, y = mean, group = 1)) +
    geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.05) +
    geom_line() +
    geom_point() +
    theme_bw() +
    ylab("Average Accuracy")+
    xlab("Trial Quarter")+ 
    ylim(.5, 1)

#Vision: 
vision <- metadata %>%group_by(subject) %>% 
  filter(modality == c('vision'))  %>%  mutate(trial_number = row_number()) %>%
  group_by(subject) 
  
vision$trial_bin <- cut(vision$trial_number, breaks = 4, labels = c("1st", "2nd", "3rd","4th"))

plot_dataV <- vision %>%
  group_by(trial_bin) %>%
  summarise(mean = mean(accuracy), se = sd(accuracy)/sqrt(length(accuracy))) %>%
  ungroup()
  
SV<-ggplot(data = plot_dataV, aes(x = trial_bin, y = mean, group = 1)) +
    geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.05) +
    geom_line() +
    geom_point() +
    theme_bw() +
    ylab("Average Accuracy")+
    xlab("Trial Quarter")+ 
    ylim(.5, 1)


DatafilStair <- ggarrange(SM, SC, SG, SV)
  annotate_figure(DatafilStair, top = text_grob("Group-level Staircasing", color = "black",face = "bold", size = 14))

```
Average confidence across domains, split by correct and incorrect trials:
```{r}
#Average confidence for Correct trials:
AvgConfCorr <- metadata %>% filter(accuracy==1) %>%
  group_by(subject, modality) %>% 
  summarise(avgCF_Corr=mean(confidence, na_rm=TRUE))
#Average confidence for incorrect trials            
AvgConfInCo <- metadata %>% filter(accuracy==0) %>%
  group_by(subject, modality) %>% 
  summarise(avgCF_Incor=mean(confidence, na_rm=TRUE))


ggSplit<-ggplot() + geom_boxjitter(data=AvgConfCorr, aes(x = modality, y = avgCF_Corr), color="blue") +
  geom_boxjitter(data=AvgConfInCo, aes(x = modality, y = avgCF_Incor), color="red")+
    theme_bw() +
    ylab("Average Confidence")+
    xlab("Modality")
annotate_figure(ggSplit, top = text_grob("Confidence for Correct and Incorrect Trials across Modalities", color = "black",face = "bold", size = 14)) 


```


Let's loop over subjects now and fit the MLE model. 

```{r}

subjects = unique(metadata$subject) # subjects vector, for looping
modalities = as.character(unique(metadata$modality)) # modalities vector, for looping


# setup cluster
n.cores <- parallel::detectCores() - 1 # 1 less than max cores to prevent crashing

# since R can only work with around 120 cores maximum, set an upper limit if needed
if (n.cores > 120) {
n.cores <- 120
}


#create the cluster
my.cluster <- parallel::makeCluster(
  n.cores, 
  type = "PSOCK"
)

#register it to be used by %dopar%
doParallel::registerDoParallel(cl = my.cluster)


# fit all subjects in parallel
source(here("r", "parMLEfit.R"))

# stop the cluster
stopCluster(cl = my.cluster)

# write out the data file
write.csv(fit_data, file = here("data_summary","mle_mratio_fit_data.csv"))

head(fit_data)

```

Group-level exclusion based on MAD rule (confidence, d', criterion)
```{r}

#exclude those where mratio could not be estimated  
metadata_exc <- fit_data%>%filter(mratio!="NaN")


#Exclude outliers based on MAD rule (confidence, d' and criterion)
#Confidence:
Avgmeta <- metadata %>% 
  group_by(subject, modality) %>% 
  summarise(avg_conf=mean(confidence, na_rm=TRUE)) #Mean confidence for each modality

#join Avgmeta with fit_data 
fitAvg_data<- fit_data %>% full_join(Avgmeta, 
                                   by= c('subject'='subject', 
                                         'modality' = 'modality'))

fitAvg_data <- fitAvg_data%>%filter(mratio!="NaN")

metadata_exc <- fitAvg_data%>%
  group_by(modality) %>%
  mutate(avg_conf = remove_outliers_robust(avg_conf)) # remove RT outliers using MAD Rule 

#d' 
metadata_exc <- metadata_exc%>%
  group_by(modality) %>%
  mutate(da = remove_outliers_robust(da)) # remove RT outliers using MAD Rule 


#criterion 
metadata_exc <- metadata_exc%>%
  group_by(modality) %>%
  mutate(c = remove_outliers_robust(c)) # remove RT outliers using MAD Rule 

metadata_exc <- na.omit(metadata_exc)

head(metadata_exc)


```

Plots of key metacognitive measures for both filtered and unfiltered data: 
```{r}

#unfiltered
p1<-ggplot(fitAvg_data, aes(x = modality, y =c)) +
  geom_boxjitter() +
  ggtitle("Criterion Unfiltered")
p2<-ggplot(fitAvg_data, aes(x = modality, y = avg_conf)) +
  geom_boxjitter() +
  ggtitle("Metacognitive Bias Unfiltered")
p3<-ggplot(fitAvg_data, aes(x = modality, y = mda)) +
  geom_boxjitter() +
  ggtitle("Metacognitive Sensitivity Unfiltered")
p4<-ggplot(fitAvg_data, aes(x = modality, y = da)) +
  geom_boxjitter() +
 # ylim(-2,2)+
  ggtitle("Cognitive Sensitivity Unfiltered")
p5<-ggplot(fitAvg_data, aes(x = modality, y = mratio)) +
  geom_boxjitter() +
 # ylim(-2,2)+
  ggtitle("Metacognitive efficiency Unfiltered")

#filtered Plots: 
p6<-ggplot(metadata_exc, aes(x = modality, y =c)) +
  geom_boxjitter() +
  ggtitle("Cognitive Criterion") +
  ylab("c") + xlab("Modality")
p7<-ggplot(metadata_exc, aes(x = modality, y = avg_conf)) +
  geom_boxjitter() +
  ggtitle("Metacognitive Bias")+
  ylab("Average Confidence") + xlab("Modality")
p8<-ggplot(metadata_exc, aes(x = modality, y = mratio)) +
  geom_boxjitter() +
  ggtitle("Metacognitive Efficiency")+
  ylab("Meta-d'/d'") + xlab("Modality")
p9<-ggplot(metadata_exc, aes(x = modality, y = da)) +
  geom_boxjitter() +
  ggtitle("Cognitive Sensitivity")+ 
  ylab("d'") + xlab("Modality")
p10<-ggplot(metadata_exc, aes(x = modality, y = mda)) +
  geom_boxjitter() +
  ggtitle("Metacognitive Sensitivity")+ 
  ylab("meta-d'") + xlab("Modality")

# Filtered versus unfiltered 
filunfil1 <- ggarrange(p1, p6)
  annotate_figure(filunfil1, top = text_grob("Cognitive Criterion filtered/unfiltered", color = "black", face = "bold", size = 14))
filunfil5 <- ggarrange(p4, p9)
  annotate_figure(filunfil5, top = text_grob("Cognitive Sensitivity filtered/unfiltered", color = "black",face = "bold", size = 14))
filunfil2 <- ggarrange(p2, p7)
  annotate_figure(filunfil2, top = text_grob("Metaognitive Bias filtered/unfiltered", color = "black", face = "bold", size = 14))
filunfil3 <- ggarrange(p3, p10)
  annotate_figure(filunfil3, top = text_grob("Metacognitive Sensitivity filtered/unfiltered",   color = "black", face = "bold", size = 14))
filunfil4 <- ggarrange(p5, p8)
  annotate_figure(filunfil4, top = text_grob("Metacognitive Efficiency filtered/unfiltered", color = "black",  face = "bold", size = 14))


#Filtered dataÂ´: 
Datafil1 <- ggarrange(p9, p6)
  annotate_figure(Datafil1, top = text_grob("MLE Estimation of Cognitive performance", color = "black",face = "bold", size = 14))  
Datafi2 <- ggarrange(p7, p10, p8, ncol = 3)
  annotate_figure(Datafi2, top = text_grob("MLE Estimation of Metacognitive performance", 
  color = "black", face = "bold", size = 14))  

```




Pivot the data frame to wide. 

```{r}

fit_data_wide <- metadata_exc %>% pivot_wider(
  names_from = modality,
  values_from = c(da, mda, mratio, c, avg_conf)
)
  

write.csv(fit_data_wide, file = here("data_summary","mle_mratio_fit_data_wide.csv"))

head(fit_data_wide)
```

Correlation  between domains: Using GRousselet bootcorci
```{r}

# Each correlation pair is estimated for Metacognitive sensitivity: 
corr <- fit_data_wide %>%
  na.omit() %>%
  select(starts_with("mda"))
res1 <- corci(corr$mda_memory, corr$mda_Calories, method="spearman")
res2 <- corci(corr$mda_memory, corr$mda_vision, method="spearman")
res3 <- corci(corr$mda_memory, corr$mda_GDP, method="spearman")
res4 <- corci(corr$mda_GDP, corr$mda_vision, method="spearman")
res5 <- corci(corr$mda_GDP, corr$mda_Calories, method="spearman")
res6 <- corci(corr$mda_Calories, corr$mda_vision, method="spearman")

# Each correlation pair is estimated for efficiency: 
corr1 <- fit_data_wide %>%
  na.omit() %>%
  select(starts_with("mratio"))
res1.1 <- corci(corr1$mratio_memory, corr1$mratio_Calories, method="spearman")
res1.2 <- corci(corr1$mratio_memory, corr1$mratio_vision, method="spearman")
res1.3 <- corci(corr1$mratio_memory, corr1$mratio_GDP, method="spearman")
res1.4 <- corci(corr1$mratio_GDP, corr1$mratio_vision, method="spearman")
res1.5 <- corci(corr1$mratio_GDP, corr1$mratio_Calories, method="spearman")
res1.6 <- corci(corr1$mratio_Calories, corr1$mratio_vision, method="spearman")

# Each correlation pair is estimated for bias: 
corr2 <- fit_data_wide %>%
  na.omit() %>%
  select(starts_with("avg"))
res2.1 <- corci(corr2$avg_conf_memory, corr2$avg_conf_Calories, method="spearman")
res2.2 <- corci(corr2$avg_conf_memory, corr2$avg_conf_vision, method="spearman")
res2.3 <- corci(corr2$avg_conf_memory, corr2$avg_conf_GDP, method="spearman")
res2.4 <- corci(corr2$avg_conf_GDP, corr2$avg_conf_vision, method="spearman")
res2.5 <- corci(corr2$avg_conf_GDP, corr2$avg_conf_Calories, method="spearman")
res2.6 <- corci(corr2$avg_conf_Calories, corr2$avg_conf_vision, method="spearman")

# Each correlation pair is estimated for Cognitive sensitivity: 
corr3 <- fit_data_wide %>%
  na.omit() %>%
  select(starts_with("da"))
res31 <- corci(corr3$da_memory, corr3$da_Calories, method="spearman")
res32 <- corci(corr3$da_memory, corr3$da_vision, method="spearman")
res33 <- corci(corr3$da_memory, corr3$da_GDP, method="spearman")
res34 <- corci(corr3$da_GDP, corr3$da_vision, method="spearman")
res35 <- corci(corr3$da_GDP, corr3$da_Calories, method="spearman")
res36 <- corci(corr3$da_Calories, corr3$da_vision, method="spearman")


#Table with correlation coefficents for all pairwise correlations: 
corrtable <- data.frame(Metric=character(),
                 MemCalCoef=double(),
                 CI_lowerMC=double(),
                 CI_upperMC=double(),
                 P_valueMC=double(),
                 MemVisCoef=double(),
                 CI_lowerMV=double(),
                 CI_upperMV=double(),
                 P_valueMV=double(),
                 MemGDPCoef=double(),
                 CI_lowerMG=double(),
                 CI_upperMG=double(),
                 P_valueMG=double(),
                 GDPVisCoef=double(),
                 CI_lowerGS=double(),
                 CI_upperGS=double(),
                 P_valueGS=double(),
                 GDPCalCoef=double(),
                 CI_lowerGC=double(),
                 CI_upperGC=double(),
                 P_valueGC=double(),
                 CalVisCoef=double(),
                 CI_lowerCV=double(),
                 CI_upperCV=double(),
                 P_valueCV=double(),
                stringsAsFactors=FALSE)

#Insert vaules in dataframe: 
corrtable[1,] <- list("Meta-d",res1$estimate,res1$conf.int[1], res1$conf.int[2], res1$p.value,
                       res2$estimate,res2$conf.int[1], res2$conf.int[2], res2$p.value,
                       res3$estimate,res3$conf.int[1], res3$conf.int[2],  res3$p.value,
                       res4$estimate,res4$conf.int[1], res4$conf.int[2],  res4$p.value,
                       res5$estimate,res5$conf.int[1], res5$conf.int[2],  res5$p.value,
                       res6$estimate,res6$conf.int[1],  res6$conf.int[2], res6$p.value)
corrtable[2,] <- list("Mratio",res1.1$estimate,res1.1$conf.int[1], res1.1$conf.int[2], res1.1$p.value,
                       res1.2$estimate,res1.2$conf.int[1], res1.2$conf.int[2], res1.2$p.value,
                       res1.3$estimate,res1.3$conf.int[1], res1.3$conf.int[2],  res1.3$p.value,
                       res1.4$estimate,res1.4$conf.int[1], res1.4$conf.int[2],  res1.4$p.value,
                       res1.5$estimate,res1.5$conf.int[1], res1.5$conf.int[2],  res1.5$p.value,
                       res1.6$estimate,res1.6$conf.int[1],  res1.6$conf.int[2], res1.6$p.value)
corrtable[3,] <- list("Bias",res1$estimate,res2.1$conf.int[1], res2.1$conf.int[2], res2.1$p.value,
                       res2.2$estimate,res2.2$conf.int[1], res2.2$conf.int[2], res2.2$p.value,
                       res2.3$estimate,res2.3$conf.int[1], res2.3$conf.int[2],  res2.3$p.value,
                       res2.4$estimate,res2.4$conf.int[1], res2.4$conf.int[2],  res2.4$p.value,
                       res2.5$estimate,res2.5$conf.int[1], res2.5$conf.int[2],  res2.5$p.value,
                       res2.6$estimate,res2.6$conf.int[1],  res2.6$conf.int[2], res2.6$p.value)
corrtable[4,] <- list("d'",res31$estimate,res31$conf.int[1], res31$conf.int[2], res31$p.value,
                       res32$estimate,res32$conf.int[1], res32$conf.int[2], res32$p.value,
                       res33$estimate,res33$conf.int[1], res33$conf.int[2],  res33$p.value,
                       res34$estimate,res34$conf.int[1], res34$conf.int[2],  res34$p.value,
                       res35$estimate,res35$conf.int[1], res35$conf.int[2],  res35$p.value,
                       res36$estimate,res36$conf.int[1],  res36$conf.int[2], res36$p.value)

head(corrtable)


```

Scatter plots and linear regressions: 
```{r}

#Metacognitive Sensitivity
scat1 <- as_tibble(corr)
s1 <-scatter(scat1, scat1$mda_memory, scat1$mda_Calories) + 
  scale_y_continuous("Calories")+ scale_x_continuous("Memory")
s2 <- scatter(scat1, scat1$mda_memory, scat1$mda_vision) + 
  scale_y_continuous("Vision")+ scale_x_continuous("Memory")
s3 <- scatter(scat1, scat1$mda_memory, scat1$mda_GDP) + 
  scale_y_continuous("GDP")+ scale_x_continuous("Memory")
s4 <- scatter(scat1, scat1$mda_GDP, scat1$mda_vision) + 
  scale_y_continuous("Vision")+ scale_x_continuous("GDP")
s5 <- scatter(scat1, scat1$mda_GDP, scat1$mda_Calories) + 
  scale_y_continuous("Calories")+ scale_x_continuous("GDP")
s6 <- scatter(scat1, scat1$mda_Calories, scat1$mda_vision) +
  scale_y_continuous("Vision") + scale_x_continuous("Calories")

comPlot1 <- ggarrange(s1, s2, s3, s4, s5, s6)
annotate_figure(comPlot1, top = text_grob("Metacognitive Sensitivity", color = "black", 
                                         face = "bold", size = 14))  

#Metacognitive Efficiency
scat2 <- as_tibble(corr1)
s11 <-scatter(scat2, scat2$mratio_memory, scat2$mratio_Calories) +
  scale_y_continuous("Calories")+scale_x_continuous("Memory")
s12 <- scatter(scat2, scat2$mratio_memory, scat2$mratio_vision) +
  scale_y_continuous("Vision")+scale_x_continuous("Memory")
s13 <- scatter(scat2, scat2$mratio_memory, scat2$mratio_GDP) +
  scale_y_continuous("GDP")+scale_x_continuous("Memory")
s14 <- scatter(scat2, scat2$mratio_GDP, scat2$mratio_vision) + 
  scale_y_continuous("Vision")+scale_x_continuous("GDP")
s15 <- scatter(scat2, scat2$mratio_GDP, scat2$mratio_Calories) + 
  scale_y_continuous("Calories")+ scale_x_continuous("GDP")
s16 <- scatter(scat2, scat2$mratio_Calories, scat2$mratio_vision) + 
  scale_y_continuous("Vision")+scale_x_continuous("Calories")

comPlot2 <- ggarrange(s11, s12, s13, s14, s15, s16)
annotate_figure(comPlot2, top = text_grob("Metacognitive Efficiency", color = "black", 
                                         face = "bold", size = 14))    


#Metacognitive Bias
scat3 <- as_tibble(corr2)
s21 <-scatter(scat3, scat3$avg_conf_memory, scat3$avg_conf_Calories) +
  scale_y_continuous("Calories") + scale_x_continuous("Memory")
s22 <- scatter(scat3, scat3$avg_conf_memory, scat3$avg_conf_vision) + 
  scale_y_continuous("Vision") + scale_x_continuous("Memory")
s23 <- scatter(scat3, scat3$avg_conf_memory, scat3$avg_conf_GDP) + 
  scale_y_continuous("GDP") + scale_x_continuous("Memory")
s24 <- scatter(scat3, scat3$avg_conf_GDP, scat3$avg_conf_vision) + 
  scale_y_continuous("Vision") + scale_x_continuous("GDP")
s25 <- scatter(scat3, scat3$avg_conf_GDP, scat3$avg_conf_Calories) + 
  scale_y_continuous("Calories") + scale_x_continuous("GDP")
s26 <- scatter(scat3, scat3$avg_conf_Calories, scat3$avg_conf_vision) + 
  scale_y_continuous("Vision") + scale_x_continuous("Calories")

comPlot3 <- ggarrange(s21, s22, s23, s24, s25, s26)
annotate_figure(comPlot3, top = text_grob("Metacognitive Bias", color = "black", 
                                         face = "bold", size = 14))     

```


Bootstrap samples 
```{r}

b1 <- plotBoot(res1) + ggtitle("Memory and Calories")
b2 <- plotBoot(res2) + ggtitle("Memory and Vision")
b3 <- plotBoot(res3) + ggtitle("Memory and GDP")
b4 <- plotBoot(res4) + ggtitle("GDP and Vision")
b5 <- plotBoot(res5) + ggtitle("GDP and Calories")
b6 <- plotBoot(res6) + ggtitle("Vision and Calories")
BootPlot1 <- ggarrange(b1, b2, b3, b4, b5, b6)
annotate_figure(BootPlot1, top = text_grob("Bootstrap samples of Meta-d' correlations", color = "black", 
                                         face = "bold", size = 14))  

b11 <- plotBoot(res1.1) + ggtitle("Memory and Calories")
b12 <- plotBoot(res1.2) + ggtitle("Memory and Vision")
b13 <- plotBoot(res1.3) + ggtitle("Memory and GDP")
b14 <- plotBoot(res1.4) + ggtitle("GDP and Vision")
b15 <- plotBoot(res1.5) + ggtitle("GDP and Calories")
b16 <- plotBoot(res1.6) + ggtitle("Vision and Calories")
BootPlot2 <- ggarrange(b11, b12, b13, b14, b15, b16)
annotate_figure(BootPlot2, top = text_grob("Bootstrap samples of Mratio correlations Efficiency", color = "black", 
                                         face = "bold", size = 14))  
b21 <- plotBoot(res2.1) + ggtitle("Memory and Calories")
b22 <- plotBoot(res2.2) + ggtitle("Memory and Vision")
b23 <- plotBoot(res2.3) + ggtitle("Memory and GDP")
b24 <- plotBoot(res2.4) + ggtitle("GDP and Vision")
b25 <- plotBoot(res2.5) + ggtitle("GDP and Calories")
b26 <- plotBoot(res2.6) + ggtitle("Vision and Calories")
BootPlot3 <- ggarrange(b21, b22, b23, b24, b25, b26)
annotate_figure(BootPlot3, top = text_grob("Bootstrap samples of Meta-bias correlations", color = "black", 
                                         face = "bold", size = 14))  

```

Bayes Factor: 
!!! COMBINE PLOTS + SUMMARY OF Stats. 
```{r}
# Metacognitive sensitivity 
 source(here("r", "Bayesfactor.R"))
  
bf1 <- bayes(corr$mda_memory, corr$mda_Calories)
bf2 <- bayes(corr$mda_memory, corr$mda_vision)
bf3 <- bayes(corr$mda_memory, corr$mda_GDP)
bf4 <- bayes(corr$mda_GDP, corr$mda_vision)
bf5 <- bayes(corr$mda_GDP, corr$mda_Calories)
bf6 <- bayes(corr$mda_Calories, corr$mda_vision)
BayesPlot1 <- ggarrange(plot, bf2, bf3, bf4, bf5, bf6)
annotate_figure(BayesPlot1, top = text_grob("Bayesfactor samples of Meta-d' correlations", color = "black", 
                                         face = "bold", size = 14))  
#Metacognitive Efficiency
bf11 <- bayes(corr1$mratio_memory, corr1$mratio_Calories)
bf12 <- bayes(corr1$mratio_memory, corr1$mratio_vision)
bf13 <- bayes(corr1$mratio_memory, corr1$mratio_GDP)
bf14 <- bayes(corr1$mratio_GDP, corr1$mratio_vision)
bf15 <- bayes(corr1$mratio_GDP, corr1$mratio_Calories)
bf16 <- bayes(corr1$mratio_Calories, corr1$mratio_vision)
BayesPlot2 <- ggarrange(bf11, bf12, bf13, bf14, bf15, bf16)
annotate_figure(BayesPlot2, top = text_grob("Bayesfactor samples of Mratio' correlations", color = "black", 
                                         face = "bold", size = 14))  
#Metacognitive bias 
bf1 <- bayes(corr2$avg_conf_memory, corr2$avg_conf_Calories)
bf2 <- bayes(corr2$avg_conf_memory, corr2$avg_conf_vision)
bf3 <- bayes(corr2$avg_conf_memory, corr2$avg_conf_GDP)
bf4 <- bayes(corr2$avg_conf_GDP, corr2$avg_conf_vision)
bf5 <- bayes(corr2$avg_conf_GDP, corr2$avg_conf_Calories)
bf6 <- bayes(corr2$avg_conf_Calories, corr2$avg_conf_vision)
BayesPlot1 <- ggarrange(bf21, bf22, bf23, bf24, bf25, bf26)
annotate_figure(BayesPlot1, top = text_grob("Bayesfactor samples of Meta-d' correlations", color = "black", 
                                         face = "bold", size = 14))  


```






